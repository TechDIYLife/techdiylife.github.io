<!DOCTYPE html><html><head>
      <title>AIå¼€å‘è€…é¢‘é“</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<p>ã€æœ¬æ–‡é€šè¿‡ChatGPTç¿»è¯‘ï¼Œä»…ä¾›å‚è€ƒä½¿ç”¨ï¼Œå»ºè®®å¯¹ç…§è‹±æ–‡é˜…è¯»ã€‘<br>
åŸæ–‡åœ°å€ï¼š<a href="https://python.langchain.com/docs/get_started/quickstart">https://python.langchain.com/docs/get_started/quickstart</a></p>
<p><strong>ç›®å½•ç´¢å¼•</strong></p>
<div class="code-chunk" data-id="code-chunk-id-0" data-cmd="toc"><div class="input-div"><div class="code-chunk-btn-group"><div class="run-btn btn btn-xs btn-primary"><span>â–¶ï¸</span></div><div class="run-all-btn btn btn-xs btn-primary">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><ul>
<li><a href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8quickstart--%EF%B8%8F-langchain">å¿«é€Ÿå…¥é—¨ï¼ˆQuickStartï¼‰ | ğŸ¦œï¸ğŸ”— Langchain</a>
<ul>
<li><a href="#%E8%AE%BE%E7%BD%AE">è®¾ç½®</a>
<ul>
<li><a href="#jupyter-notebook">Jupyter Notebook</a></li>
<li><a href="#%E5%AE%89%E8%A3%85">å®‰è£…</a></li>
<li><a href="#langsmith">LangSmith</a></li>
</ul>
</li>
<li><a href="#%E4%BD%BF%E7%94%A8langchain%E8%BF%9B%E8%A1%8C%E6%9E%84%E5%BB%BA">ä½¿ç”¨LangChainè¿›è¡Œæ„å»º</a></li>
<li><a href="#llm-chain%E9%93%BE%E6%9D%A1">LLM Chainé“¾æ¡</a></li>
<li><a href="#%E6%A3%80%E7%B4%A2%E9%93%BE%E6%9D%A1">æ£€ç´¢é“¾æ¡</a></li>
<li><a href="#%E5%AF%B9%E8%AF%9D%E5%BC%8F%E6%A3%80%E7%B4%A2%E9%93%BE%E6%9D%A1">å¯¹è¯å¼æ£€ç´¢é“¾æ¡</a></li>
<li><a href="#%E6%99%BA%E8%83%BD%E4%BD%93">æ™ºèƒ½ä½“</a></li>
<li><a href="#%E9%80%9A%E8%BF%87langserve%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1">é€šè¿‡LangServeéƒ¨ç½²æœåŠ¡</a></li>
<li><a href="#playground">Playground</a></li>
<li><a href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9A%84%E6%AD%A5%E9%AA%A4">æ¥ä¸‹æ¥çš„æ­¥éª¤</a></li>
</ul>
</li>
</ul>
<h1 id="å¿«é€Ÿå…¥é—¨quickstart--ï¸-langchain">å¿«é€Ÿå…¥é—¨ï¼ˆQuickStartï¼‰ | ğŸ¦œï¸ğŸ”— Langchain </h1>
<p>åœ¨è¿™ä¸ªå¿«é€Ÿå…¥é—¨æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šä¸€æ­¥æ­¥æŒ‡å¯¼æ‚¨å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š</p>
<ul>
<li>å®‰è£…å¹¶è®¾ç½®LangChainã€LangSmithä»¥åŠLangServe</li>
<li>æŒæ¡LangChainä¸­æœ€åŸºç¡€å’Œå¸¸ç”¨çš„å…ƒç´ ï¼šæç¤ºæ¨¡æ¿ã€æ¨¡å‹å’Œè¾“å‡ºè§£æå™¨</li>
<li>å­¦ä¹ å’Œä½¿ç”¨LangChainè¡¨è¾¾å¼è¯­è¨€ï¼Œè¿™æ˜¯LangChainåŸºç¡€æ¶æ„çš„æ ¸å¿ƒï¼Œå®ƒä½¿å¾—å„ä¸ªç»„ä»¶èƒ½å¤Ÿè¿›è¡Œé“¾å¼è¿æ¥</li>
<li>åˆ©ç”¨LangChainå¼€å‘ä¸€ä¸ªç®€å•çš„åº”ç”¨</li>
<li>ä½¿ç”¨LangSmithæ¥è¿½è¸ªå’Œè°ƒè¯•æ‚¨çš„åº”ç”¨</li>
<li>é€šè¿‡LangServeéƒ¨ç½²å’Œæä¾›æ‚¨çš„åº”ç”¨æœåŠ¡<br>
å†…å®¹é¢‡å¤šï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼</li>
</ul>
<h2 id="è®¾ç½®">è®¾ç½® </h2>
<h3 id="jupyter-notebook">Jupyter Notebook </h3>
<p>è¿™ä¸ªæ•™ç¨‹ï¼ˆåŒ…æ‹¬æ–‡æ¡£ä¸­çš„å…¶ä»–å¤šæ•°æ•™ç¨‹ï¼‰é‡‡ç”¨äº†Jupyter Notebookï¼Œå¹¶ä¸”å‡è®¾æ‚¨ä¹Ÿå°†ä½¿ç”¨å®ƒã€‚Jupyter Notebookæ˜¯å­¦ä¹ å¦‚ä½•æ“ä½œå¤§è¯­è¨€æ¨¡å‹ç³»ç»Ÿçš„ç†æƒ³å·¥å…·ï¼Œå› ä¸ºåœ¨å®é™…æ“ä½œä¸­å¾ˆå®¹æ˜“é‡åˆ°å„ç§é—®é¢˜ï¼ˆæ¯”å¦‚æ„å¤–çš„è¾“å‡ºç»“æœã€APIæ— æ³•è®¿é—®ç­‰ï¼‰ï¼Œé€šè¿‡äº¤äº’å¼çš„å­¦ä¹ ç¯å¢ƒï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´æ·±å…¥åœ°ç†è§£è¿™äº›ç³»ç»Ÿã€‚</p>
<p>è™½ç„¶ä¸å¼ºåˆ¶è¦æ±‚æ‚¨é€šè¿‡Jupyter Notebookæ¥å­¦ä¹ è¿™ä¸ªæ•™ç¨‹ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯æ¨èä½¿ç”¨å®ƒã€‚å®‰è£…æ–¹æ³•è¯·å‚è€ƒï¼š<a href="https://jupyter.org/install">https://jupyter.org/install</a></p>
<p>ã€Linuxä¸Šå®‰è£…æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å‚è€ƒå°±çˆ±çé¼“æ£æ•´ç†çš„èµ„æ–™ï¼š<a href="https://techdiylife.github.io/blog/blog.html?category1=c02&amp;blogid=0028%E3%80%91">https://techdiylife.github.io/blog/blog.html?category1=c02&amp;blogid=0028ã€‘</a></p>
<h3 id="å®‰è£…">å®‰è£… </h3>
<p>è¦å®‰è£…LangChainï¼Œè¯·è¿è¡Œï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code># pip
pip install langchain
# conda
conda install langchain -c conda-forge
</code></pre><h3 id="langsmith">LangSmith </h3>
<p>åœ¨æ‚¨åˆ©ç”¨LangChainå¼€å‘çš„åº”ç”¨ä¸­ï¼Œå¾€å¾€ä¼šåŒ…å«å¤šæ­¥éª¤æ“ä½œï¼Œè¿™äº›æ­¥éª¤ä¸­å¯èƒ½ä¼šå¤šæ¬¡è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹(LLM)ã€‚éšç€åº”ç”¨çš„å¤æ‚åº¦æ—¥ç›Šå¢åŠ ï¼Œèƒ½å¤Ÿæ¸…æ¥šåœ°æŸ¥çœ‹å¹¶äº†è§£æ‚¨çš„é“¾æ¡æˆ–æ™ºèƒ½ä½“å†…éƒ¨çš„å…·ä½“è¿ä½œæƒ…å†µæ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚å®ç°è¿™ä¸€ç‚¹ï¼ŒLangSmithæä¾›äº†æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚</p>
<p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œè™½ç„¶LangSmithä¸æ˜¯ç»å¯¹å¿…éœ€çš„ï¼Œä½†å®ƒåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­æä¸ºæœ‰ç”¨ã€‚å¦‚æœæ‚¨æ‰“ç®—ä½¿ç”¨LangSmithï¼Œè¯·åœ¨ä¸Šé¢æä¾›çš„é“¾æ¥æ³¨å†Œåï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ä»¥å¯åŠ¨æ—¥å¿—è·Ÿè¸ªåŠŸèƒ½ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>export LANGCHAIN_TRACING_V2="true"
export LANGCHAIN_API_KEY="..."
</code></pre><h2 id="ä½¿ç”¨langchainè¿›è¡Œæ„å»º">ä½¿ç”¨LangChainè¿›è¡Œæ„å»º </h2>
<p>LangChainè®©æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºåº”ç”¨ï¼Œè¿™äº›åº”ç”¨èƒ½å¤ŸæŠŠå¤–éƒ¨çš„æ•°æ®æºå’Œè®¡ç®—èƒ½åŠ›æ¥å…¥åˆ°å¤§å‹è¯­è¨€æ¨¡å‹(LLM)ä¸­ã€‚åœ¨æœ¬å¿«é€Ÿå…¥é—¨æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢å‡ ç§ä¸åŒçš„å®ç°æ–¹æ³•ã€‚æˆ‘ä»¬é¦–å…ˆä»æ„å»ºä¸€ä¸ªç®€æ˜“çš„LLMé“¾å¼€å§‹ï¼Œè¿™ä¸ªé“¾æ¡ä»…ä»…ä¾èµ–äºæç¤ºæ¨¡æ¿é‡Œçš„ä¿¡æ¯æ¥ç»™å‡ºå›åº”ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªæ£€ç´¢é“¾æ¡ï¼Œå®ƒèƒ½ä»ç‹¬ç«‹çš„æ•°æ®åº“ä¸­æ‹‰å–æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®æ•´åˆåˆ°æç¤ºæ¨¡æ¿ä¸­ã€‚ä¹‹åï¼Œæˆ‘ä»¬è¿˜ä¼šå¼•å…¥å¯¹è¯å†å²åŠŸèƒ½ï¼Œåˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œå¯¹è¯æ£€ç´¢çš„é“¾æ¡ã€‚è¿™æ ·åšè®©æ‚¨å¯ä»¥ä»¥å¯¹è¯çš„å½¢å¼ä¸LLMäº¤äº’ï¼Œå®ƒèƒ½è®°ä½ä¹‹å‰çš„æé—®ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬å°†å¼€å‘ä¸€ä¸ªæ™ºèƒ½ä½“ï¼Œè¿™ä¸ªæ™ºèƒ½ä½“ä¼šåˆ©ç”¨LLMæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹‰å–å¤–éƒ¨æ•°æ®æ¥å›ç­”é—®é¢˜ã€‚æˆ‘ä»¬å°†å¯¹è¿™äº›å†…å®¹åšä¸€ä¸ªæ¦‚è§ˆæ€§çš„ä»‹ç»ï¼Œå°½ç®¡è¿™é‡Œé¢åŒ…å«äº†å¾ˆå¤šç»†èŠ‚ï¼æˆ‘ä»¬ä¹Ÿä¼šæä¾›ç›¸å…³çš„æ–‡æ¡£é“¾æ¥ã€‚</p>
<h2 id="llm-chainé“¾æ¡">LLM Chainé“¾æ¡ </h2>
<p>æˆ‘ä»¬å°†æŒ‡å¯¼æ‚¨å¦‚ä½•è°ƒç”¨åƒOpenAIè¿™æ ·é€šè¿‡APIæä¾›çš„æ¨¡å‹ï¼Œä»¥åŠå¦‚ä½•å€ŸåŠ©Ollamaè¿™ç±»é›†æˆå·¥å…·ä½¿ç”¨æœ¬åœ°çš„å¼€æºæ¨¡å‹ã€‚</p>
<p><strong>ä½¿ç”¨Ollama</strong><br>
Ollamaä½¿æ‚¨èƒ½å¤Ÿæœ¬åœ°è¿è¡Œå¼€æºçš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œæ¯”å¦‚Llama 2ã€‚</p>
<p>é¦–å…ˆï¼Œéµå¾ªä»¥ä¸‹æ­¥éª¤æ¥è®¾ç½®å¹¶å¯åŠ¨æœ¬åœ°çš„Ollamaå®ä¾‹ï¼š</p>
<ul>
<li>å®‰è£…Ollamaå¯ä»¥å‚è€ƒï¼š <a href="https://techdiylife.github.io/blog/blog.html?category1=c02&amp;blogid=0037%E3%80%91">https://techdiylife.github.io/blog/blog.html?category1=c02&amp;blogid=0037ã€‘</a></li>
<li>ä½¿ç”¨å‘½ä»¤ollama pull llama2æ‹‰å–æ¨¡å‹</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œè¯·ç¡®ä¿OllamaæœåŠ¡å™¨å¤„äºè¿è¡ŒçŠ¶æ€ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain_community<span class="token punctuation">.</span>llms <span class="token keyword keyword-import">import</span> Ollama
llm <span class="token operator">=</span> Ollama<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">"llama2"</span><span class="token punctuation">)</span>
</code></pre><p>ä¸€æ—¦æ‚¨å®‰è£…å¹¶åˆå§‹åŒ–äº†æ‰€é€‰çš„LLMï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å°è¯•ä½¿ç”¨å®ƒäº†ï¼è®©æˆ‘ä»¬è¯¢é—®å®ƒå…³äºLangSmithçš„ä¿¡æ¯â€”â€”è€ƒè™‘åˆ°è¿™ä¸æ˜¯å®ƒè®­ç»ƒæ•°æ®ä¸­çš„å†…å®¹ï¼Œå®ƒå¯èƒ½æ— æ³•ç»™å‡ºå¾ˆå¥½çš„å›ç­”ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>llm<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token string">"how can langsmith help with testing?"</span><span class="token punctuation">)</span>
</code></pre><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æç¤ºæ¨¡æ¿æ¥å¼•å¯¼å®ƒçš„å›ç­”ã€‚æç¤ºæ¨¡æ¿å¸®åŠ©å°†åŸå§‹çš„ç”¨æˆ·è¾“å…¥è½¬åŒ–ä¸ºLLMèƒ½æ›´å¥½ç†è§£çš„è¾“å…¥å½¢å¼ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain_core<span class="token punctuation">.</span>prompts <span class="token keyword keyword-import">import</span> ChatPromptTemplate
prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_messages<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"You are world class technical documentation writer."</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"{input}"</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›å…ƒç´ ç»„åˆæˆä¸€ä¸ªç®€å•çš„LLMé“¾æ¡ï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>chain <span class="token operator">=</span> prompt <span class="token operator">|</span> llm
</code></pre><p>ç°åœ¨æˆ‘ä»¬å†æ¬¡æå‡ºåŒæ ·çš„é—®é¢˜ã€‚å°½ç®¡å®ƒå¯èƒ½ä»æ—§ä¸çŸ¥é“ç­”æ¡ˆï¼Œä½†å®ƒåº”è¯¥ä¼šä»¥ä¸€ç§æ›´é€‚åˆæŠ€æœ¯æ–‡æ¡£æ’°å†™è€…çš„è¯­è°ƒæ¥å›åº”ï¼</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>chain<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"how can langsmith help with testing?"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>ChatModelï¼ˆä»¥åŠè¿™ä¸ªé“¾æ¡ï¼‰çš„è¾“å‡ºæ˜¯ä¸€æ¡æ¶ˆæ¯ã€‚ä½†æ˜¯ï¼Œé€šå¸¸å°†èŠå¤©æ¶ˆæ¯è½¬æ¢æˆå­—ç¬¦ä¸²å½¢å¼æ›´ä¸ºæ–¹ä¾¿ã€‚è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç®€å•çš„è¾“å‡ºè§£æå™¨æ¥å®Œæˆè¿™ä¸€è½¬æ¢ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain_core<span class="token punctuation">.</span>output_parsers <span class="token keyword keyword-import">import</span> StrOutputParser

output_parser <span class="token operator">=</span> StrOutputParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªè§£æå™¨åŠ å…¥åˆ°ä¹‹å‰çš„é“¾æ¡ä¸­ï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>chain <span class="token operator">=</span> prompt <span class="token operator">|</span> llm <span class="token operator">|</span> output_parser
</code></pre><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å†æ¬¡æé—®ç›¸åŒçš„é—®é¢˜ã€‚ç°åœ¨çš„ç­”æ¡ˆå°†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆè€Œä¸æ˜¯ChatMessageï¼‰ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>chain<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"how can langsmith help with testing?"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p><strong>è¿›ä¸€æ­¥äº†è§£</strong><br>
åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»åŸºæœ¬ä¸Šå®Œæˆäº†LLMé“¾çš„åˆæ­¥è®¾ç½®ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä»…ä»…æ¶‰åŠäº†æç¤ºã€æ¨¡å‹å’Œè¾“å‡ºè§£æå™¨ç­‰æ–¹é¢çš„åŸºç¡€çŸ¥è¯†ã€‚å¦‚æœæ‚¨æƒ³æ·±å…¥å­¦ä¹ è¿™é‡ŒæåŠçš„æ‰€æœ‰ç»†èŠ‚å’ŒçŸ¥è¯†ç‚¹ï¼Œè¯·å‚è€ƒæ–‡æ¡£: <a href="https://python.langchain.com/docs/modules/model_io">https://python.langchain.com/docs/modules/model_io</a></p>
<h2 id="æ£€ç´¢é“¾æ¡">æ£€ç´¢é“¾æ¡ </h2>
<p>ä¸ºäº†ç²¾ç¡®å›ç­”èµ·åˆçš„é—®é¢˜ï¼ˆâ€œhow can langsmith help with testing?â€ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æä¾›æ›´å¤šçš„èƒŒæ™¯ä¿¡æ¯ã€‚è¿™å¯ä»¥é€šè¿‡æ£€ç´¢åŠŸèƒ½æ¥å®Œæˆã€‚å½“ç›´æ¥å‘LLMä¼ é€’å¤§é‡æ•°æ®å˜å¾—ä¸åˆ‡å®é™…æ—¶ï¼Œæ£€ç´¢å°¤å…¶æœ‰ç”¨ã€‚ä½ å¯ä»¥å€ŸåŠ©æ£€ç´¢å·¥å…·æ¥æŒ‘é€‰å‡ºæœ€ç›¸å…³çš„ä¿¡æ¯è¿›è¡Œä¼ é€’ã€‚</p>
<p>åœ¨è¿™ä¸ªæµç¨‹é‡Œï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ä¸€ä¸ªæ£€ç´¢å·¥å…·å¯»æ‰¾ç›¸å…³æ–‡æ¡£ï¼Œç„¶åå°†è¿™äº›æ–‡æ¡£æ•´åˆè¿›æç¤ºè¯­ä¸­ã€‚æ£€ç´¢å·¥å…·å¯ä»¥åŸºäºå„ç§èµ„æºâ€”â€”å¦‚SQLæ•°æ®åº“ã€äº’è”ç½‘ç­‰â€”â€”ä½†åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å¡«å……ä¸€ä¸ªå‘é‡åº“ï¼Œå¹¶å°†å…¶ä½œä¸ºæ£€ç´¢å·¥å…·ã€‚æƒ³äº†è§£æ›´å¤šå…³äºå‘é‡åº“çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒè¿™ä»½æ–‡æ¡£ï¼ˆ<a href="https://python.langchain.com/docs/modules/data_connection/vectorstores%EF%BC%89%E3%80%82">https://python.langchain.com/docs/modules/data_connection/vectorstoresï¼‰ã€‚</a></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡å¥½è¦å»ºç«‹ç´¢å¼•çš„æ•°æ®ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†åˆ©ç”¨WebBaseLoaderè¿›è¡Œæ“ä½œã€‚æ“ä½œå‰éœ€å®‰è£…BeautifulSoupï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>pip install beautifulsoup4
</code></pre><p>å®‰è£…å®Œæˆåï¼Œå°±å¯ä»¥å¯¼å…¥å¹¶ä½¿ç”¨WebBaseLoaderäº†ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain_community<span class="token punctuation">.</span>document_loaders <span class="token keyword keyword-import">import</span> WebBaseLoader
loader <span class="token operator">=</span> WebBaseLoader<span class="token punctuation">(</span><span class="token string">"https://docs.smith.langchain.com/user_guide"</span><span class="token punctuation">)</span>

docs <span class="token operator">=</span> loader<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°æ®ç´¢å¼•åˆ°å‘é‡åº“ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦å‡ ä¸ªå…³é”®ç»„ä»¶ï¼ŒåŒ…æ‹¬åµŒå…¥æ¨¡å‹å’Œå‘é‡åº“ã€‚</p>
<p>åœ¨åµŒå…¥æ¨¡å‹æ–¹é¢ï¼Œæˆ‘ä»¬æä¾›äº†é€šè¿‡APIæ¥å…¥æˆ–æœ¬åœ°è¿è¡Œæ¨¡å‹çš„ç¤ºä¾‹ã€‚</p>
<p><strong>ä½¿ç”¨Ollama</strong><br>
ç¡®ä¿Ollamaå·²ç»å¯åŠ¨ï¼ˆè®¾ç½®æ–¹æ³•ä¸LLMç›¸åŒï¼‰ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain_community<span class="token punctuation">.</span>embeddings <span class="token keyword keyword-import">import</span> OllamaEmbeddings

embeddings <span class="token operator">=</span> OllamaEmbeddings<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>å€ŸåŠ©è¿™ä¸ªåµŒå…¥æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ–‡æ¡£å¼•å…¥åˆ°å‘é‡åº“ä¸­ã€‚ä¸ºäº†ç®€åŒ–è¿‡ç¨‹ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨ä¸€ä¸ªç®€å•çš„æœ¬åœ°å‘é‡åº“FAISSã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å¿…éœ€çš„è½¯ä»¶åŒ…ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>pip install faiss-cpu
</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å»ºç«‹æˆ‘ä»¬çš„ç´¢å¼•ï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain_community<span class="token punctuation">.</span>vectorstores <span class="token keyword keyword-import">import</span> FAISS
<span class="token keyword keyword-from">from</span> langchain_text_splitters <span class="token keyword keyword-import">import</span> RecursiveCharacterTextSplitter

text_splitter <span class="token operator">=</span> RecursiveCharacterTextSplitter<span class="token punctuation">(</span><span class="token punctuation">)</span>
documents <span class="token operator">=</span> text_splitter<span class="token punctuation">.</span>split_documents<span class="token punctuation">(</span>docs<span class="token punctuation">)</span>
vector <span class="token operator">=</span> FAISS<span class="token punctuation">.</span>from_documents<span class="token punctuation">(</span>documents<span class="token punctuation">,</span> embeddings<span class="token punctuation">)</span>
</code></pre><p>å°†æ•°æ®ç´¢å¼•åˆ°å‘é‡åº“ä¹‹åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªæ£€ç´¢é“¾ã€‚è¿™ä¸ªé“¾æ¡ä¼šæ¥æ”¶ä¸€ä¸ªé—®é¢˜ï¼Œå¯»æ‰¾ç›¸å…³çš„æ–‡æ¡£ï¼Œç„¶åå°†è¿™äº›æ–‡æ¡£è¿åŒåŸå§‹é—®é¢˜ä¸€èµ·æäº¤ç»™LLMï¼Œè¯·æ±‚å®ƒè§£ç­”åŸé—®é¢˜ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è®¾ç½®ä¸€ä¸ªèƒ½å¤Ÿå–å¾—é—®é¢˜å’Œæ£€ç´¢æ–‡æ¡£å¹¶ç”Ÿæˆç­”æ¡ˆçš„é“¾æ¡ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain<span class="token punctuation">.</span>chains<span class="token punctuation">.</span>combine_documents <span class="token keyword keyword-import">import</span> create_stuff_documents_chain

prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""Answer the following question based only on the provided context:
&lt;context&gt;
{context}
&lt;/context&gt;
Question: {input}"""</span><span class="token punctuation">)</span>
document_chain <span class="token operator">=</span> create_stuff_documents_chain<span class="token punctuation">(</span>llm<span class="token punctuation">,</span> prompt<span class="token punctuation">)</span>
</code></pre><p>ç†è®ºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥ä¼ é€’æ–‡æ¡£æ¥è¿è¡Œè¿™ä¸ªé“¾æ¡ï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain_core<span class="token punctuation">.</span>documents <span class="token keyword keyword-import">import</span> Document

document_chain<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"how can langsmith help with testing?"</span><span class="token punctuation">,</span>
    <span class="token string">"context"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Document<span class="token punctuation">(</span>page_content<span class="token operator">=</span><span class="token string">"langsmith can let you visualize test results"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>ä½†æˆ‘ä»¬å¸Œæœ›æ–‡æ¡£èƒ½å…ˆé€šè¿‡æˆ‘ä»¬åˆšè®¾ç½®å¥½çš„æ£€ç´¢å™¨è·å–ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬èƒ½åŠ¨æ€åœ°ä¸ºç‰¹å®šé—®é¢˜é€‰å‡ºæœ€ç›¸å…³çš„æ–‡æ¡£å¹¶ä¼ é€’ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain<span class="token punctuation">.</span>chains <span class="token keyword keyword-import">import</span> create_retrieval_chain

retriever <span class="token operator">=</span> vector<span class="token punctuation">.</span>as_retriever<span class="token punctuation">(</span><span class="token punctuation">)</span>
retrieval_chain <span class="token operator">=</span> create_retrieval_chain<span class="token punctuation">(</span>retriever<span class="token punctuation">,</span> document_chain<span class="token punctuation">)</span>
</code></pre><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨è¿™ä¸ªé“¾æ¡äº†ã€‚è¿™ä¼šè¿”å›ä¸€ä¸ªå­—å…¸â€”â€”LLMçš„å›ç­”åœ¨ç­”æ¡ˆé”®ä¸­</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>response = retrieval_chain.invoke({"input": "how can langsmith help with testing?"})
print(response["answer"])

# LangSmith offers several features that can help with testing:...
</code></pre><p>è¿™ä¸ªç­”æ¡ˆåº”è¯¥æ›´åŠ å‡†ç¡®ï¼<br>
<strong>è¿›ä¸€æ­¥äº†è§£</strong><br>
æˆ‘ä»¬å·²ç»æˆåŠŸåœ°å»ºç«‹äº†ä¸€ä¸ªåŸºç¡€çš„æ£€ç´¢é“¾æ¡ã€‚è¿™é‡Œæˆ‘ä»¬åªè§¦åŠäº†æ£€ç´¢çš„åŸºæœ¬æ¦‚å¿µâ€”â€”æƒ³è¦æ·±å…¥å­¦ä¹ è¿™é‡Œæåˆ°çš„æ‰€æœ‰å†…å®¹ï¼Œè¯·å‚è€ƒæ–‡æ¡£ï¼ˆ<a href="https://python.langchain.com/docs/modules/data_connection%EF%BC%89%E3%80%82">https://python.langchain.com/docs/modules/data_connectionï¼‰ã€‚</a></p>
<h2 id="å¯¹è¯å¼æ£€ç´¢é“¾æ¡">å¯¹è¯å¼æ£€ç´¢é“¾æ¡ </h2>
<p>æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„é“¾æ¡åªèƒ½å›ç­”å•ä¸ªé—®é¢˜ã€‚è€ŒèŠå¤©æœºå™¨äººæ˜¯äººä»¬æ­£åœ¨æ„å»ºçš„LLMåº”ç”¨ä¸­çš„ä¸€ä¸ªä¸»è¦ç±»å‹ã€‚å¦‚ä½•è®©æˆ‘ä»¬çš„é“¾æ¡èƒ½å¤Ÿå›ç­”è¿ç»­çš„é—®é¢˜å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ä½¿ç”¨create_retrieval_chainå‡½æ•°ï¼Œä½†éœ€è¦è°ƒæ•´ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>ç°åœ¨çš„æ£€ç´¢æ–¹æ³•ä¸ä»…ä»…æ˜¯åŸºäºæœ€æ–°çš„è¾“å…¥ï¼Œè€Œæ˜¯åº”å½“è€ƒè™‘æ•´ä¸ªå¯¹è¯å†å²ã€‚</li>
<li>æœ€ç»ˆçš„LLMé“¾æ¡ä¹Ÿåº”è¯¥è€ƒè™‘åˆ°æ•´ä¸ªå¯¹è¯å†å²ã€‚</li>
</ul>
<p>æ›´æ–°æ£€ç´¢è¿‡ç¨‹</p>
<p>ä¸ºäº†æ›´æ–°æ£€ç´¢è¿‡ç¨‹ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„é“¾æ¡ã€‚è¿™ä¸ªé“¾æ¡ä¼šå°†æœ€æ–°çš„è¾“å…¥å’Œå¯¹è¯å†å²æ•´åˆèµ·æ¥ï¼Œåˆ©ç”¨LLMç”Ÿæˆä¸€ä¸ªæœç´¢æŸ¥è¯¢ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain<span class="token punctuation">.</span>chains <span class="token keyword keyword-import">import</span> create_history_aware_retriever
<span class="token keyword keyword-from">from</span> langchain_core<span class="token punctuation">.</span>prompts <span class="token keyword keyword-import">import</span> MessagesPlaceholder

<span class="token comment"># æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæç¤ºï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥è®©LLMç”Ÿæˆæœç´¢æŸ¥è¯¢</span>

prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_messages<span class="token punctuation">(</span><span class="token punctuation">[</span>
    MessagesPlaceholder<span class="token punctuation">(</span>variable_name<span class="token operator">=</span><span class="token string">"chat_history"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"{input}"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"æ ¹æ®ä¸Šè¿°å¯¹è¯ï¼Œç”Ÿæˆä¸€ä¸ªæœç´¢æŸ¥è¯¢ä»¥æŸ¥æ‰¾ä¸å¯¹è¯ç›¸å…³çš„ä¿¡æ¯"</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
retriever_chain <span class="token operator">=</span> create_history_aware_retriever<span class="token punctuation">(</span>llm<span class="token punctuation">,</span> retriever<span class="token punctuation">,</span> prompt<span class="token punctuation">)</span>
</code></pre><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç”¨æˆ·æå‡ºåç»­é—®é¢˜çš„å®ä¾‹æ¥è¿›è¡Œæµ‹è¯•ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain_core<span class="token punctuation">.</span>messages <span class="token keyword keyword-import">import</span> HumanMessage<span class="token punctuation">,</span> AIMessage

chat_history <span class="token operator">=</span> <span class="token punctuation">[</span>HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"LangSmithèƒ½å¸®åŠ©æµ‹è¯•æˆ‘çš„LLMåº”ç”¨å—ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> AIMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"å¯ä»¥ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
retriever_chain<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">"chat_history"</span><span class="token punctuation">:</span> chat_history<span class="token punctuation">,</span>
    <span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"å‘Šè¯‰æˆ‘æ€ä¹ˆåš"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>ä½ å°†ä¼šçœ‹åˆ°ï¼Œè¿™å°†è¿”å›å…³äºåœ¨LangSmithä¸­è¿›è¡Œæµ‹è¯•çš„æ–‡æ¡£ã€‚è¿™æ˜¯å› ä¸ºLLMæ ¹æ®èŠå¤©å†å²å’Œåç»­é—®é¢˜ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„æŸ¥è¯¢ã€‚</p>
<p>æœ‰äº†è¿™ä¸ªæ–°çš„æ£€ç´¢å·¥å…·åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„é“¾æ¡ï¼Œè€ƒè™‘è¿™äº›æ£€ç´¢åˆ°çš„æ–‡æ¡£æ¥ç»§ç»­å¯¹è¯ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_messages<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"æ ¹æ®ä¸‹é¢çš„ä¸Šä¸‹æ–‡å›ç­”ç”¨æˆ·çš„é—®é¢˜ï¼š\n\n{context}"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    MessagesPlaceholder<span class="token punctuation">(</span>variable_name<span class="token operator">=</span><span class="token string">"chat_history"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"{input}"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
document_chain <span class="token operator">=</span> create_stuff_documents_chain<span class="token punctuation">(</span>llm<span class="token punctuation">,</span> prompt<span class="token punctuation">)</span>

retrieval_chain <span class="token operator">=</span> create_retrieval_chain<span class="token punctuation">(</span>retriever_chain<span class="token punctuation">,</span> document_chain<span class="token punctuation">)</span>
</code></pre><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æ•´ä½“è¿›è¡Œæµ‹è¯•äº†ï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>chat_history <span class="token operator">=</span> <span class="token punctuation">[</span>HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"LangSmithèƒ½å¸®åŠ©æµ‹è¯•æˆ‘çš„LLMåº”ç”¨å—ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> AIMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"å¯ä»¥ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
retrieval_chain<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">"chat_history"</span><span class="token punctuation">:</span> chat_history<span class="token punctuation">,</span>
    <span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"å‘Šè¯‰æˆ‘æ€ä¹ˆåš"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç»™å‡ºäº†ä¸€ä¸ªè¿è´¯çš„ç­”æ¡ˆâ€”â€”æˆ‘ä»¬å·²ç»æˆåŠŸåœ°æŠŠæˆ‘ä»¬çš„æ£€ç´¢é“¾æ¡è½¬å˜æˆäº†ä¸€ä¸ªèŠå¤©æœºå™¨äººï¼</p>
<h2 id="æ™ºèƒ½ä½“">æ™ºèƒ½ä½“ </h2>
<p>æˆ‘ä»¬ä¹‹å‰åˆ›å»ºäº†ä¸€ç³»åˆ—é“¾æ¡ï¼Œæ¯ä¸€æ­¥çš„æ“ä½œéƒ½æ˜¯é¢„å…ˆå®šä¹‰çš„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦åˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ™ºèƒ½ä½“ï¼Œæ™ºèƒ½ä½“å°†ç”±LLMå†³å®šå…¶ä¸‹ä¸€æ­¥çš„æ“ä½œã€‚</p>
<p>æ³¨æ„ï¼šæœ¬ç¤ºä¾‹ä»…å±•ç¤ºå¦‚ä½•åˆ©ç”¨OpenAIæ¨¡å‹åˆ›å»ºæ™ºèƒ½ä½“ï¼Œå› ä¸ºç›®å‰æœ¬åœ°æ¨¡å‹çš„ç¨³å®šæ€§è¿˜ä¸è¶³ã€‚</p>
<p>æ„å»ºæ™ºèƒ½ä½“çš„ç¬¬ä¸€æ­¥æ˜¯ç¡®å®šå®ƒåº”è¯¥èƒ½å¤Ÿè®¿é—®å“ªäº›å·¥å…·ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºæ™ºèƒ½ä½“æä¾›ä¸¤ç§å·¥å…·ï¼š</p>
<ul>
<li>æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„æ£€ç´¢å™¨ï¼Œä½¿å…¶èƒ½å¤Ÿè½»æ¾å›ç­”å…³äºLangSmithçš„é—®é¢˜ã€‚</li>
<li>ä¸€ä¸ªæœç´¢å·¥å…·ï¼Œä½¿å…¶èƒ½å¤Ÿè½»æ¾å›ç­”éœ€è¦æœ€æ–°ä¿¡æ¯çš„é—®é¢˜ã€‚</li>
</ul>
<p>é¦–å…ˆï¼Œä¸ºæˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„æ£€ç´¢å™¨è®¾ç½®ä¸€ä¸ªå·¥å…·ï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>retriever <span class="token keyword keyword-import">import</span> create_retriever_tool

retriever_tool <span class="token operator">=</span> create_retriever_tool<span class="token punctuation">(</span>
    retriever<span class="token punctuation">,</span>
    <span class="token string">"langsmith_search"</span><span class="token punctuation">,</span>
    <span class="token string">"æœç´¢å…³äºLangSmithçš„ä¿¡æ¯ã€‚å¯¹äºä»»ä½•å…³äºLangSmithçš„é—®é¢˜ï¼Œä½ å¿…é¡»ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre><p>æˆ‘ä»¬ä½¿ç”¨çš„æœç´¢å·¥å…·æ˜¯Tavilyï¼Œè¿™éœ€è¦ä¸€ä¸ªAPIå¯†é’¥ï¼ˆä»–ä»¬æä¾›äº†å®½æ¾çš„å…è´¹é¢åº¦ï¼‰ã€‚åœ¨ä»–ä»¬å¹³å°ä¸Šåˆ›å»ºåï¼Œä½ éœ€è¦å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªç¯å¢ƒå˜é‡ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>export TAVILY_API_KEY=...
</code></pre><p>å¦‚æœä½ ä¸æƒ³è®¾ç½®APIå¯†é’¥ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸ªå·¥å…·çš„åˆ›å»ºã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain_community<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>tavily_search <span class="token keyword keyword-import">import</span> TavilySearchResults

search <span class="token operator">=</span> TavilySearchResults<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹åˆ›å»ºæˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„å·¥å…·åˆ—è¡¨äº†ï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>tools <span class="token operator">=</span> <span class="token punctuation">[</span>retriever_tool<span class="token punctuation">,</span> search<span class="token punctuation">]</span>
</code></pre><p>æœ‰äº†è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ™ºèƒ½ä½“æ¥ä½¿ç”¨å®ƒä»¬ã€‚æˆ‘ä»¬å°†å¿«é€Ÿä»‹ç»è¿™ä¸ªè¿‡ç¨‹â€”â€”è¦æ›´æ·±å…¥äº†è§£å…·ä½“å†…å®¹ï¼Œè¯·æŸ¥çœ‹æ™ºèƒ½ä½“å…¥é—¨æ–‡æ¡£ï¼ˆ<a href="https://python.langchain.com/docs/modules/agents%EF%BC%89%E3%80%82">https://python.langchain.com/docs/modules/agentsï¼‰ã€‚</a></p>
<p>é¦–å…ˆå®‰è£…langchain hubï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>pip install langchainhub
</code></pre><p>å®‰è£…langchain-openaiåŒ…ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½å¤Ÿä¸OpenAIäº¤äº’ï¼Œè¿™éœ€è¦ä½¿ç”¨è¿æ¥åˆ°OpenAI SDKçš„langchain-openai[<a href="https://github.com/langchain-ai/langchain/tree/master/libs/partners/openai">https://github.com/langchain-ai/langchain/tree/master/libs/partners/openai</a>]ã€‚</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>pip install langchain-openai
</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è·å–ä¸€ä¸ªé¢„å®šä¹‰çš„æç¤ºï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langchain_openai <span class="token keyword keyword-import">import</span> ChatOpenAI
<span class="token keyword keyword-from">from</span> langchain <span class="token keyword keyword-import">import</span> hub
<span class="token keyword keyword-from">from</span> langchain<span class="token punctuation">.</span>agents <span class="token keyword keyword-import">import</span> create_openai_functions_agent
<span class="token keyword keyword-from">from</span> langchain<span class="token punctuation">.</span>agents <span class="token keyword keyword-import">import</span> AgentExecutor

<span class="token comment"># è·å–è¦ä½¿ç”¨çš„æç¤º - ä½ å¯ä»¥ä¿®æ”¹è¿™ä¸ªï¼</span>
prompt <span class="token operator">=</span> hub<span class="token punctuation">.</span>pull<span class="token punctuation">(</span><span class="token string">"hwchase17/openai-functions-agent"</span><span class="token punctuation">)</span>

<span class="token comment"># ä½ éœ€è¦è®¾ç½®OPENAI_API_KEYç¯å¢ƒå˜é‡æˆ–ä½œä¸ºå‚æ•°`openai_api_key`ä¼ é€’ã€‚</span>
llm <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span> temperature<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
agent <span class="token operator">=</span> create_openai_functions_agent<span class="token punctuation">(</span>llm<span class="token punctuation">,</span> tools<span class="token punctuation">,</span> prompt<span class="token punctuation">)</span>
agent_executor <span class="token operator">=</span> AgentExecutor<span class="token punctuation">(</span>agent<span class="token operator">=</span>agent<span class="token punctuation">,</span> tools<span class="token operator">=</span>tools<span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥è°ƒç”¨æ™ºèƒ½ä½“å¹¶æŸ¥çœ‹å®ƒçš„ååº”ï¼æˆ‘ä»¬å¯ä»¥è¯¢é—®å®ƒæœ‰å…³LangSmithçš„é—®é¢˜ï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>agent_executor<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"LangSmithå¦‚ä½•å¸®åŠ©è¿›è¡Œæµ‹è¯•ï¼Ÿ"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è¯¢é—®å®ƒå¤©æ°”æƒ…å†µï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>agent_executor<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"SFçš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>æˆ‘ä»¬å¯ä»¥ä¸å®ƒè¿›è¡Œå¯¹è¯ï¼š</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>chat_history <span class="token operator">=</span> <span class="token punctuation">[</span>HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"LangSmithèƒ½å¸®åŠ©æµ‹è¯•æˆ‘çš„LLMåº”ç”¨å—ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> AIMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"å¯ä»¥ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
agent_executor<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">"chat_history"</span><span class="token punctuation">:</span> chat_history<span class="token punctuation">,</span>
    <span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"å‘Šè¯‰æˆ‘æ€ä¹ˆåš"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>æ·±å…¥äº†è§£<br>
æˆ‘ä»¬å·²ç»æˆåŠŸåœ°è®¾ç½®äº†ä¸€ä¸ªåŸºç¡€æ™ºèƒ½ä½“ã€‚è¿™é‡Œæˆ‘ä»¬åªæ˜¯åˆæ­¥ä»‹ç»äº†æ™ºèƒ½ä½“çš„åŸºæœ¬æ¦‚å¿µâ€”â€”æƒ³è¦æ›´æ·±å…¥äº†è§£è¿™é‡ŒæåŠçš„æ‰€æœ‰å†…å®¹ï¼Œè¯·å‚è€ƒæ–‡æ¡£çš„ç›¸å…³éƒ¨åˆ†ï¼ˆ<a href="https://python.langchain.com/docs/modules/agents%EF%BC%89%E3%80%82">https://python.langchain.com/docs/modules/agentsï¼‰ã€‚</a></p>
<h2 id="é€šè¿‡langserveéƒ¨ç½²æœåŠ¡">é€šè¿‡LangServeéƒ¨ç½²æœåŠ¡ </h2>
<p>æ—¢ç„¶æˆ‘ä»¬å·²ç»å¼€å‘å‡ºäº†ä¸€ä¸ªåº”ç”¨ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å°†å®ƒéƒ¨ç½²æˆæœåŠ¡çš„æ—¶å€™äº†ã€‚LangServeå°±æ˜¯ä¸ºæ­¤è€Œç”Ÿã€‚LangServeèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…å°†LangChainçš„é“¾æ¡ä»¥REST APIçš„å½¢å¼éƒ¨ç½²ã€‚è™½ç„¶ä½¿ç”¨LangChainä¸å¼ºåˆ¶è¦æ±‚ä½¿ç”¨LangServeï¼Œä½†åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘æ‚¨å±•ç¤ºå¦‚ä½•åˆ©ç”¨LangServeæ¥éƒ¨ç½²æ‚¨çš„åº”ç”¨ã€‚</p>
<p>æœ¬æŒ‡å—çš„å‰åŠéƒ¨æ˜¯åœ¨Jupyter Notebookä¸­å®Œæˆçš„ï¼Œç°åœ¨æˆ‘ä»¬å°†è½¬å‘ä¸åŒçš„ç¯å¢ƒã€‚æˆ‘ä»¬å³å°†åˆ›å»ºä¸€ä¸ªPythonæ–‡ä»¶ï¼Œå¹¶é€šè¿‡å‘½ä»¤è¡Œæ¥æ“ä½œå®ƒã€‚</p>
<p>å®‰è£…LangServeï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>pip install "langserve[all]"
</code></pre><p>æœåŠ¡å™¨è®¾ç½®</p>
<p>ä¸ºäº†æ­å»ºæˆ‘ä»¬åº”ç”¨çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåä¸ºserve.pyçš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å°†åŒ…å«æœåŠ¡é€»è¾‘ã€‚ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>æˆ‘ä»¬ä¹‹å‰æ„å»ºçš„é“¾æ¡çš„å®šä¹‰</li>
<li>FastAPIåº”ç”¨</li>
<li>å®šä¹‰ä¸€ä¸ªè·¯ç”±æ¥æä¾›é“¾æ¡æœåŠ¡ï¼Œè¿™é€šè¿‡ä½¿ç”¨langserve.add_routesæ¥å®Œæˆ</li>
</ul>
<pre data-role="codeBlock" data-info="" class="language-text"><code>#!/usr/bin/env python
from typing import List

from fastapi import FastAPI
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI
from langchain_community.document_loaders import WebBaseLoader
from langchain_openai import OpenAIEmbeddings
from langchain_community.vectorstores import FAISS
from langchain_text_splitters import RecursiveCharacterTextSplitter
from langchain.tools.retriever import create_retriever_tool
from langchain_community.tools.tavily_search import TavilySearchResults
from langchain import hub
from langchain.agents import create_openai_functions_agent
from langchain.agents import AgentExecutor
from langchain.pydantic_v1 import BaseModel, Field
from langchain_core.messages import BaseMessage
from langserve import add_routes

# 1. Load Retriever
loader = WebBaseLoader("https://docs.smith.langchain.com/user_guide")
docs = loader.load()
text_splitter = RecursiveCharacterTextSplitter()
documents = text_splitter.split_documents(docs)
embeddings = OpenAIEmbeddings()
vector = FAISS.from_documents(documents, embeddings)
retriever = vector.as_retriever()

# 2. Create Tools
retriever_tool = create_retriever_tool(
    retriever,
    "langsmith_search",
    "Search for information about LangSmith. For any questions about LangSmith, you must use this tool!",
)
search = TavilySearchResults()
tools = [retriever_tool, search]


# 3. Create Agent
prompt = hub.pull("hwchase17/openai-functions-agent")
llm = ChatOpenAI(model="gpt-3.5-turbo", temperature=0)
agent = create_openai_functions_agent(llm, tools, prompt)
agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)


# 4. App definition
app = FastAPI(
  title="LangChain Server",
  version="1.0",
  description="A simple API server using LangChain's Runnable interfaces",
)

# 5. Adding chain route

# We need to add these input/output schemas because the current AgentExecutor
# is lacking in schemas.

class Input(BaseModel):
    input: str
    chat_history: List[BaseMessage] = Field(
        ...,
        extra={"widget": {"type": "chat", "input": "location"}},
    )


class Output(BaseModel):
    output: str

add_routes(
    app,
    agent_executor.with_types(input_type=Input, output_type=Output),
    path="/agent",
)

if __name__ == "__main__":
    import uvicorn

    uvicorn.run(app, host="localhost", port=8000)
</code></pre><p>å®Œæˆï¼æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>python serve.py
</code></pre><p>æˆ‘ä»¬çš„é“¾æ¡åº”è¯¥å°±èƒ½åœ¨localhost:8000ä¸Šæä¾›æœåŠ¡äº†ã€‚</p>
<h2 id="playground">Playground </h2>
<p>LangServeæœåŠ¡è‡ªå¸¦äº†ä¸€ä¸ªç®€æ´çš„UIç•Œé¢ï¼Œå¯ä»¥å¸®åŠ©ä½ é…ç½®å’Œè°ƒç”¨ä½ çš„åº”ç”¨ï¼ŒåŒæ—¶æ”¯æŒè¾“å‡ºæµå’Œå±•ç¤ºè¿‡ç¨‹ä¸­çš„æ¯ä¸€ä¸ªæ­¥éª¤ã€‚å°è¯•è®¿é—®<a href="http://localhost:8000/agent/playground/">http://localhost:8000/agent/playground/</a> æ¥ä½“éªŒä¸€ä¸‹å§ï¼è¾“å…¥ä¹‹å‰çš„é—®é¢˜ - "how can langsmith help with testing?" - åº”è¯¥èƒ½å¾—åˆ°å’Œä¹‹å‰ç›¸åŒçš„ç­”æ¡ˆã€‚</p>
<p>å®¢æˆ·ç«¯</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç¼–ç¨‹åœ°ä¸æˆ‘ä»¬çš„æœåŠ¡è¿›è¡Œäº¤äº’äº†ã€‚é€šè¿‡ä½¿ç”¨<a href="..\..\..\docs\langserve#client">langserve.RemoteRunnable</a>ï¼Œè¿™ä¸ªè¿‡ç¨‹å˜å¾—éå¸¸ç®€å•ã€‚å€ŸåŠ©å®ƒï¼Œæˆ‘ä»¬èƒ½å¤Ÿåƒæœ¬åœ°å®¢æˆ·ç«¯è¿è¡Œä¸€æ ·ä¸æœåŠ¡ç«¯çš„é“¾æ¡è¿›è¡Œäº¤äº’ã€‚</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> langserve <span class="token keyword keyword-import">import</span> RemoteRunnable

remote_chain <span class="token operator">=</span> RemoteRunnable<span class="token punctuation">(</span><span class="token string">"http://localhost:8000/agent/"</span><span class="token punctuation">)</span>
remote_chain<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">"input"</span><span class="token punctuation">:</span> <span class="token string">"how can langsmith help with testing?"</span><span class="token punctuation">,</span>
    <span class="token string">"chat_history"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># æä¾›ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œå› ä¸ºè¿™æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p>æƒ³è¦äº†è§£LangServeæ›´å¤šå…¶ä»–åŠŸèƒ½çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹è¿™é‡Œ(<a href="https://python.langchain.com/docs/langserve">https://python.langchain.com/docs/langserve</a>)ã€‚</p>
<h2 id="æ¥ä¸‹æ¥çš„æ­¥éª¤">æ¥ä¸‹æ¥çš„æ­¥éª¤ </h2>
<p>æˆ‘ä»¬å·²ç»ç®€å•æ¢è®¨äº†å¦‚ä½•åˆ©ç”¨LangChainæ¥æ„å»ºåº”ç”¨ã€é€šè¿‡LangSmithè¿›è¡Œè·Ÿè¸ªï¼Œä»¥åŠå€ŸåŠ©LangServeè¿›è¡Œéƒ¨ç½²ã€‚è¿™ä¸‰ä¸ªç»„ä»¶éƒ½å«æœ‰ä¸°å¯Œçš„ç‰¹æ€§ï¼Œè¿œè¶…è¿‡æˆ‘ä»¬æ­¤å¤„æ‰€èƒ½æ¶‰åŠçš„èŒƒå›´ã€‚ä¸ºäº†è¿›ä¸€æ­¥æ·±åŒ–æ‚¨å¯¹è¿™äº›å·¥å…·çš„ç†è§£ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨é˜…è¯»ä»¥ä¸‹èµ„æ–™ï¼ˆå»ºè®®æŒ‰é¡ºåºï¼‰ï¼š</p>
<ul>
<li>æ‰€æœ‰è¿™äº›åŠŸèƒ½éƒ½å¾—ç›Šäº<a href="https://python.langchain.com/docs/expression_language">LangChainè¡¨è¾¾å¼è¯­è¨€ (LCEL)</a> â€”â€”ä¸€ä¸ªç”¨äºå°†å„ä¸ªç»„ä»¶é“¾æ¥èµ·æ¥çš„ç³»ç»Ÿã€‚æ·±å…¥è¯¥æ–‡æ¡£ï¼Œæ‚¨å°†æ›´åŠ æ˜ç™½å¦‚ä½•æ‰“é€ ä¸ªæ€§åŒ–çš„é“¾æ¡ã€‚</li>
<li><a href="https://python.langchain.com/docs/modules/model_io">æ¨¡å‹è¾“å…¥è¾“å‡º</a> éƒ¨åˆ†å°†å¸¦æ‚¨äº†è§£æ›´å¤šæœ‰å…³æç¤ºã€LLMsä»¥åŠè¾“å‡ºè§£æå™¨çš„ç»†èŠ‚ã€‚</li>
<li><a href="https://python.langchain.com/docs/modules/data_connection">æ£€ç´¢</a> éƒ¨åˆ†æ·±å…¥ä»‹ç»äº†ä¸æ•°æ®æ£€ç´¢ç›¸å…³çš„æ‰€æœ‰å†…å®¹ã€‚</li>
<li><a href="https://python.langchain.com/docs/modules/agents">æ™ºèƒ½ä½“</a> éƒ¨åˆ†è¯¦ç»†è®²è§£äº†ä¸æ™ºèƒ½ä½“ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯ã€‚</li>
<li>æ¢ç´¢<a href="https://python.langchain.com/docs/use_cases/">ç«¯åˆ°ç«¯çš„ä½¿ç”¨æ¡ˆä¾‹</a>å’Œ<a href="https://python.langchain.com/docs/templates">æ¨¡æ¿åº”ç”¨</a>ï¼Œäº†è§£LangChainçš„å®é™…åº”ç”¨ã€‚</li>
<li>é˜…è¯»<a href="https://python.langchain.com/docs/langsmith/">LangSmithç›¸å…³æ–‡æ¡£</a>ï¼Œæ·±å…¥äº†è§£ç”¨äºè°ƒè¯•ã€æµ‹è¯•ã€ç›‘æ§ç­‰æ–¹é¢çš„å¼ºå¤§å·¥å…·ã€‚</li>
<li>å­¦ä¹ å¦‚ä½•ä½¿ç”¨<a href="https://python.langchain.com/docs/langserve">LangServe</a>æ¥éƒ¨ç½²å’Œæä¾›æ‚¨çš„åº”ç”¨æœåŠ¡ã€‚</li>
</ul>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>